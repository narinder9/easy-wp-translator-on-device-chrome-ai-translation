class BlockFilterSorter{constructor(){if(this.tableBody=document.querySelector(".ewt-custom-data-table-table tbody"),this.filters=document.querySelectorAll(".ewt-custom-data-table-filters .ewt-filter-tab"),this.ewtDataTableObj=null,this.saveButtonEnabled=!1,this.saveButtonText=!1,this.saveButtonClass=!1,this.saveButtonAction=!1,this.saveButtonNonce=!1,this.displayAjaxNotice=!1,this.ajaxUrl=!1,window.ewtCustomTableDataObject){ewtCustomTableDataObject.save_button_enabled&&""!==ewtCustomTableDataObject.save_button_enabled&&(this.saveButtonEnabled=ewtCustomTableDataObject.save_button_enabled),ewtCustomTableDataObject.save_button_text&&""!==ewtCustomTableDataObject.save_button_text&&(this.saveButtonText=ewtCustomTableDataObject.save_button_text),ewtCustomTableDataObject.save_button_class&&""!==ewtCustomTableDataObject.save_button_class&&(this.saveButtonClass=ewtCustomTableDataObject.save_button_class),ewtCustomTableDataObject.save_button_handler&&""!==ewtCustomTableDataObject.save_button_handler&&(this.saveButtonAction=ewtCustomTableDataObject.save_button_handler),ewtCustomTableDataObject.save_button_nonce&&""!==ewtCustomTableDataObject.save_button_nonce&&(this.saveButtonNonce=ewtCustomTableDataObject.save_button_nonce),ewtCustomTableDataObject.admin_url&&""!==ewtCustomTableDataObject.admin_url&&(this.ajaxUrl=ewtCustomTableDataObject.admin_url);const inputFields=document.querySelectorAll('#ewt-custom-datatable tbody input[name="ewt_fields_status"]');inputFields.forEach(input=>{input.addEventListener("change",this.updateStatusHandler.bind(this))})}this.tableBody&&(this.ewtDataTable(),this.filters.forEach(filter=>{filter.addEventListener("input",this.datatableFilterHandler.bind(this))}))}ewtDataTable(){if(this.tableBody){this.ewtDataTableObj=new DataTable("#ewt-custom-datatable",{pageLength:25,infoCallback:function(settings,start,end,total,max){return`Showing ${start} to ${end} of ${max} records`}}),this.ewtDataTableObj.on("draw.dt",(function(e){const rows=jQuery(this).find("tbody tr");0===rows.length.length&&this.ewtDataTableObj.empty();const length=e.dt.page.info().length,page=e.dt.page.info().page;rows.each((function(index,row){const emptyCell=row.querySelector("td.dt-empty");emptyCell||(row.children[0].textContent=page*length+index+1)}))}));const tableWrp=document.getElementById("ewt-custom-datatable_wrapper"),selectWrapper=document.querySelector(".ewt-custom-data-table-filters");if(selectWrapper.remove(),tableWrp.prepend(selectWrapper),this.saveButtonEnabled&&""!==this.saveButtonText&&"false"!==this.saveButtonText){const saveButton=this.appendSaveButton(),lastRow=tableWrp.querySelector(".dt-layout-row:last-child");lastRow.before(saveButton),jQuery(`.${this.saveButtonClass}`).on("click",this.saveButtonHandler.bind(this))}}}datatableFilterHandler(e){if(this.ewtDataTableObj){let value=e.target.value,wrapper=e.target.closest(".ewt-filter-tab"),column=parseInt(wrapper.dataset.column),defaultValue;value=value!==wrapper.dataset.default&&value,this.ewtDataTableObj.column(column).search(value?new RegExp("^"+value,"i"):"",!1,!1,!1).draw()}}updateStatusHandler(e){const table=jQuery("#ewt-custom-datatable").DataTable();if(!table)return;const $tr=jQuery(e.target).closest("tr");if(!$tr.length)return;const dtRow=table.row($tr);if(!dtRow.node())return;const checked=e.target.checked,status=checked?"Supported":"Unsupported",cell=dtRow.cell(dtRow.index(),3);cell&&cell.data(status)}saveButtonHandler(e){e.preventDefault();const saveBtns=jQuery(`.${this.saveButtonClass}`);if(saveBtns.hasClass("saving"))return;if(!this.saveButtonAction||""===this.saveButtonAction||!this.saveButtonNonce||""===this.saveButtonNonce||!this.ajaxUrl||""===this.ajaxUrl)return;const selectedCheckbox=[],tdNodes=this.ewtDataTableObj.column(4).nodes();if(tdNodes.length>0&&Array.from(tdNodes).forEach(tdNode=>{const checkbox=tdNode.querySelector('input[type="checkbox"]');checkbox&&checkbox.checked&&selectedCheckbox.push(checkbox.value)}),0===selectedCheckbox.length)return;const apiSendData={action:this.saveButtonAction,ewt_nonce:this.saveButtonNonce,save_custom_fields_data:JSON.stringify(selectedCheckbox)};saveBtns.addClass("saving").html('<span class="saving-text">Saving<span class="dot" style="--i:0"></span><span class="dot" style="--i:1"></span><span class="dot" style="--i:2"></span></span>',!0),fetch(this.ajaxUrl,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"},body:new URLSearchParams(apiSendData)}).then(response=>response.json()).then(data=>{saveBtns.removeClass("saving").html(this.saveButtonText,!0),data.success&&data.data.message&&this.appendMessageNotice(data.data.message,"success")}).catch(error=>{console.log(error),error.data.message&&this.appendMessageNotice(data.data.message,"error"),saveBtns.removeClass("saving").html(this.saveButtonText,!0),console.error(error)})}appendMessageNotice(message,type){this.displayAjaxNotice&&(jQuery("#ewt-custom-fields-message-notice").remove(),clearTimeout(this.displayAjaxNotice)),this.displayAjaxNotice=setTimeout(()=>{this.displayAjaxNotice=!1,jQuery("#ewt-custom-fields-message-notice").remove()},1e4);let messageNotice=jQuery('<div id="ewt-custom-fields-message-notice" style="margin-bottom: 10px;"><p>'+message+"</p></div>");messageNotice.addClass("is-dismissible notice notice-"+type),jQuery("#ewt-settings-header").after(messageNotice)}appendSaveButton(){if(!this.saveButtonText||""===this.saveButtonText||"false"===this.saveButtonText||!this.saveButtonEnabled)return;const saveButton=document.createElement("button");return saveButton.className="button button-primary "+this.saveButtonClass,saveButton.textContent=this.saveButtonText,saveButton}}window.addEventListener("load",()=>{new BlockFilterSorter});