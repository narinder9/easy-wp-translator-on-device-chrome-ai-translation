(()=>{"use strict";var t=jQuery(".post_lang_choice"),e=function(){t.attr("data-old-value",t.children(":selected").first().val())};function n(){var t=document.querySelector("[name=post_lang_choice]");return null===t?ewtDefaultLanguage:t.value}function a(t){return void 0===t.data||null===t.data?t.path+=(t.path.indexOf("?")>=0?"&lang=":"?lang=")+n():t.data.lang=n(),t}wp.apiFetch.use(function(t,e){return void 0!==t.url||"undefined"==typeof ewtFilteredRoutes?e(t):e(function(t,e,n){var a=t.path.split("?")[0].replace(/^\/+|\/+$/g,"");return Object.values(e).find(function(t){return a===t})?n(t):t}(t,ewtFilteredRoutes,a))}),jQuery(function(n){e(),n(".post_lang_choice").on("change",function(a){var o,i,l,r,c=wp.data,s=c.select,u=c.dispatch,d=c.subscribe,p=!(null!==(o=(l=s("core/editor")).getEditedPostAttribute("title"))&&void 0!==o&&o.trim()||l.getEditedPostContent()||null!==(i=l.getEditedPostAttribute("excerpt"))&&void 0!==i&&i.trim()),g=wp.url.addQueryArgs,h=function(){var e=wp.i18n.__,n=jQuery("<div/>",{id:"ewt-dialog",style:"display:none;"}).text(e("Are you sure you want to change the language of the current content?","easy-wp-translator"));t.after(n);var a=new Promise(function(a,o){var i=function(e){switch(e){case"yes":t.data("old-value",t.children(":selected").first().val()),a();break;case"no":t.val(t.data("old-value")),o("Cancel")}n.dialog("close")},l={autoOpen:!1,modal:!0,draggable:!1,resizable:!1,title:e("Change language","easy-wp-translator"),minWidth:600,maxWidth:"100%",open:function(t,e){jQuery("body").hasClass("rtl")&&jQuery(this).parent().css({right:jQuery(this).parent().css("left"),left:"auto"})},close:function(t,e){i("no")},buttons:[{text:e("OK","easy-wp-translator"),click:function(t){i("yes")}},{text:e("Cancel","easy-wp-translator"),click:function(t){i("no")}}]};Object.assign(l,{classes:{"ui-dialog":"ewt-confirmation-modal"}}),n.dialog(l)});return{dialogContainer:n,dialogResult:a}}(),w=h.dialogContainer,f=h.dialogResult,_=a.target;location.pathname.match(/post-new.php/gi)&&p&&(r=_.value,-1!=location.search.indexOf("new_lang")?window.location.search=window.location.search.replace(/(?:new_lang=[^&]*)(&)?(.*)/,"new_lang="+r+"$1$2"):window.location.search=window.location.search+(-1!=window.location.search.indexOf("?")?"&":"?")+"new_lang="+r),n(this).data("old-value")===_.value||p?(e(),f=Promise.resolve()):w.dialog("open"),f.then(function(){var t={action:"ewt_post_lang_choice",lang:_.value,post_type:n("#post_type").val(),post_id:n("#post_ID").val(),_ewt_nonce:n("#_ewt_nonce").val()};n.post(ajaxurl,t,function(){var t,e,n;t=null,e=s("core/editor").getCurrentPost(),n=new Promise(function(n,a){t=d(function(){var t=s("core/editor").getCurrentPost(),o=t.id,i=t.status,l=t.type;s("core").getLastEntitySaveError("postType",l,o)&&a(),e.modified!==t.modified&&(location.pathname.match(/post-new.php/gi)&&"auto-draft"!==i&&o&&window.history.replaceState({id:o},"Post "+o,g("post.php",{post:o,action:"edit"})),n())})}),u("core/editor").savePost(),n.then(function(){window.location.reload()},function(){t()}).catch(function(){t()})})},function(){})}),jQuery(".tr_lang").each(function(){var t=jQuery(this).attr("id").substring(8),e=jQuery(this).parent().parent().siblings(".ewt-edit-column");jQuery(this).autocomplete({minLength:0,source:ajaxurl+"?action=ewt_posts_not_translated&post_language="+jQuery(".post_lang_choice").val()+"&translation_language="+t+"&post_type="+jQuery("#post_type").val()+"&_ewt_nonce="+jQuery("#_ewt_nonce").val(),select:function(n,a){jQuery("#htr_lang_"+t).val(a.item.id),e.html(a.item.link)}}),jQuery(this).on("blur",function(){jQuery(this).val()||(jQuery("#htr_lang_"+t).val(0),e.html(e.siblings(".hidden").children().clone()))})})})})();